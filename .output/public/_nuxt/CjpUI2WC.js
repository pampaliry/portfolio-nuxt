import{j as ae,k as se,r as m,l as re,q as le,i as ce,o as F,w as l,b as f,a as c,c as ie,s as ue,d as P,t as N,_ as fe}from"./87okn_8Y.js";import{u as me}from"./BHqLzvyV.js";import{n as de,o as pe,V as ve}from"./DHdK35KD.js";import{V as he,a as ge,b as _e}from"./CFa2Vf9M.js";import{V as H}from"./0tbtcVrS.js";import"./D4HBUJFQ.js";import"./C044_5Hl.js";const Se={class:"text-medium-emphasis","aria-live":"polite"},be={key:0},ye={class:"d-flex align-center mb-4"},Te={class:"chart-wrap",role:"img","aria-label":"Historický priebeh BPM z WebSocketu"},xe="wss://stream.binance.com:9443/ws/btcusdt@trade",p=40,T=140,Me=3,ke=12,B=800,d=180,we=56,x=10,Pe=3e4,Ne=ae({__name:"ws-bpm",setup(Be){var U;me({title:"WS BPM – Live WebSocket demo",meta:[{name:"description",content:"Živý WebSocket graf s BPM hodnotou odvodenou z reálnych dát."}]});const C=se(),L=typeof((U=C.public)==null?void 0:U.wsUrl)=="string"?C.public.wsUrl.trim():"",v=m(L||xe),s=m("disconnected"),i=m(72),W=m(72),h=B-we,X=[60,80,100,120],A=m(null);let t;const u=[],V=h,q=m(40);let g=0,_=0,M=0;function z(){return 1/Math.max(20,q.value)}let r=null,S=null,b=0;function j(){const e=Math.min(Pe,1e3*2**b);return b=Math.min(b+1,10),e}function J(){const e=j();s.value="connecting",S=setTimeout(E,e)}function Y(e){try{return JSON.parse(e)}catch{return null}}function G(e,n){if(typeof e=="object"&&e!==null){const o=e[n];if(typeof o=="number")return o;if(typeof o=="string"){const a=Number(o);if(!Number.isNaN(a))return a}}return null}function $(e){const n=["t","p","q","E","T"];for(const o of n){const a=G(e,o);if(a!==null)return a}return null}function K(e){if(!Number.isFinite(e))return 72;const n=61,o=55,a=Math.abs(Math.floor(e))%n;return o+a}function y(e,n,o){return Math.min(o,Math.max(n,e))}function E(){if(v.value){s.value="connecting";try{r=new WebSocket(v.value),r.onopen=()=>{s.value="connected",b=0},r.onmessage=e=>{const n=typeof e.data=="string"?e.data:"",o=Y(n);if(!o)return;const a=$(o);if(a==null)return;const w=y(K(a),p+5,T-5);W.value=w},r.onerror=()=>{s.value="error"},r.onclose=()=>{s.value="disconnected",I(),J()}}catch{s.value="error"}}}function I(){if(S&&(clearTimeout(S),S=null),r){try{r.close()}catch{}r=null}}function k(e){const n=y(e,p,T),o=d-2*x;return x+(1-(n-p)/(T-p))*o}function Q(){t.strokeStyle="#e5e7eb",t.lineWidth=1;for(let e=0;e<h;e+=40)t.beginPath(),t.moveTo(e+.5,0),t.lineTo(e+.5,d),t.stroke();for(let e=0;e<d;e+=40)t.beginPath(),t.moveTo(0,e+.5),t.lineTo(h,e+.5),t.stroke()}function Z(){const e=h+.5;t.strokeStyle="#9ca3af",t.lineWidth=1,t.beginPath(),t.moveTo(e,x),t.lineTo(e,d-x),t.stroke(),t.fillStyle="#374151",t.font="12px system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, sans-serif",t.textAlign="left",t.textBaseline="middle",X.forEach(o=>{const a=k(o);t.strokeStyle="#d1d5db",t.beginPath(),t.moveTo(e,a),t.lineTo(e+8,a),t.stroke(),t.fillText(String(o),e+12,a)});const n=k(i.value);t.fillStyle="#16a34a",t.beginPath(),t.arc(e+10,n,4,0,Math.PI*2),t.fill()}function ee(){if(!(u.length<2)){t.strokeStyle="#16a34a",t.lineWidth=2,t.beginPath();for(let e=0;e<u.length;e++){const n=e,o=k(u[e]);e===0?t.moveTo(n,o):t.lineTo(n,o)}t.stroke()}}function te(){t.clearRect(0,0,B,d),Q(),ee(),Z()}function R(e){const n=e||performance.now();_||(_=n);const o=Math.min(.05,(n-_)/1e3);_=n;const a=Math.min(1,Me*o),w=(W.value-i.value)*a,D=ke*o,oe=y(w,-D,D);i.value=y(i.value+oe,p,T),M+=o;const O=z();for(;M>=O;)u.length>=V&&u.shift(),u.push(i.value),M-=O;te(),g=requestAnimationFrame(R)}re(()=>{const e=A.value;if(!e)return;const n=e.getContext("2d");if(n){t=n;for(let o=0;o<V;o++)u.push(i.value);g=requestAnimationFrame(R),v.value&&E()}}),le(()=>{g&&cancelAnimationFrame(g),I()});function ne(e,n=36,o=18){return e.length<=n+o+1?e:`${e.slice(0,n)}…${e.slice(-o)}`}return(e,n)=>(F(),ce(ve,{class:"py-12",fluid:""},{default:l(()=>[f(de,{justify:"center"},{default:l(()=>[f(pe,{cols:"12",md:"10",lg:"8"},{default:l(()=>[f(he,{class:"pa-6",elevation:"8",role:"region","aria-label":"Live WebSocket BPM"},{default:l(()=>[f(ge,{class:"d-flex align-center justify-space-between flex-wrap"},{default:l(()=>[n[1]||(n[1]=c("span",{class:"text-h5"},"WebSocket BPM (minimal)",-1)),c("div",Se,[f(H,{color:s.value==="connected"?"green":s.value==="connecting"?"orange":s.value==="error"?"red":"grey",size:"small",class:"mr-2"},{default:l(()=>[P(N(s.value),1)]),_:1},8,["color"]),s.value!=="disconnected"?(F(),ie("span",be,[c("small",null,[n[0]||(n[0]=P("WS: ")),c("code",null,N(ne(v.value)),1)])])):ue("",!0)])]),_:1,__:[1]}),f(_e,null,{default:l(()=>[c("div",ye,[n[2]||(n[2]=c("strong",null,"BPM:",-1)),f(H,{size:"small",color:"primary",class:"ml-2"},{default:l(()=>[P(N(Math.round(i.value)),1)]),_:1})]),c("div",Te,[c("canvas",{ref_key:"canvasRef",ref:A,class:"chart",width:B,height:d},null,512)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),Ue=fe(Ne,[["__scopeId","data-v-970d7ed6"]]);export{Ue as default};
